{
  "$schema": "https://raw.githubusercontent.com/Microsoft/azure-pipelines-task-lib/master/tasks.schema.json",
  "id": "cc22f084-2258-4564-bda6-c37f40e601dc",
  "name": "OpenCodeAgent",
  "friendlyName": "OpenCode Azure DevOps extension",
  "description": "Azure DevOps pipeline task that responds to PR comments containing '/oc' or '/opencode' by executing the OpenCode AI agent and committing changes back to the PR",
  "helpMarkDown": "This task is triggered by comments in pull requests that contain '/oc' or '/opencode'. It finds the comment, executes the OpenCode AI agent with the PR context, and commits any changes back to the pull request.",
  "author": "trojanmartin",
  "version": {
    "Major": 0,
    "Minor": 4,
    "Patch": 0
  },
  "instanceNameFormat": "OpenCode",
  "minimumAgentVersion": "2.206.1",
  "inputs": [
    {
      "name": "threadId",
      "type": "string",
      "label": "Thread ID",
      "required": false,
      "helpMarkDown": "The ID of the PR thread containing the trigger comment. Auto-detected from $(System.PullRequest.ThreadId) if not provided."
    },
    {
      "name": "commentId",
      "type": "string",
      "label": "Comment ID",
      "required": false,
      "helpMarkDown": "The ID of the comment that triggered this task. Auto-detected from $(System.PullRequest.CommentId) if not provided."
    },
    {
      "name": "pat",
      "type": "string",
      "label": "Personal Access Token",
      "required": true,
      "helpMarkDown": "Azure DevOps PAT with access to read/write pull request comments and commit code changes."
    },
    {
      "name": "providerID",
      "type": "string",
      "label": "Provider ID",
      "required": true,
      "helpMarkDown": "OpenCode provider ID (e.g., github-copilot, anthropic, openai). See https://opencode.ai/ for available providers and configuration."
    },
    {
      "name": "modelID",
      "type": "string",
      "label": "Model ID",
      "required": true,
      "helpMarkDown": "OpenCode model ID to use (e.g., gpt-4.1, claude-sonnet-4). See https://opencode.ai/ for available models per provider."
    },
    {
      "name": "agent",
      "type": "string",
      "label": "Agent",
      "defaultValue": "build",
      "required": false,
      "helpMarkDown": "OpenCode agent name to execute (default: build). See https://opencode.ai/ for available agents."
    },
    {
      "name": "mode",
      "type": "pickList",
      "label": "Execution Mode",
      "defaultValue": "command",
      "required": true,
      "options": {
        "command": "Command - Execute agent with user's command",
        "review": "Review - Perform code review of PR changes"
      },
      "helpMarkDown": "Select how the OpenCode agent should run. Use 'command' to execute the user's comment request or 'review' to perform an automated code review."
    },
    {
      "name": "skipClone",
      "type": "boolean",
      "label": "Skip Git Clone",
      "defaultValue": "false",
      "required": false,
      "helpMarkDown": "If true, skips cloning the repository and uses the existing workspace. When enabled, 'Workspace Path' becomes required and must point to an existing repository checkout (e.g., $(Build.SourcesDirectory))."
    },
    {
      "name": "workspacePath",
      "type": "string",
      "label": "Workspace Path",
      "required": false,
      "helpMarkDown": "Path for the repository workspace. Defaults to $(Build.BinariesDirectory) if available, otherwise $(Agent.TempDirectory). When 'Skip Git Clone' is enabled, this must be provided and should point to an existing repository checkout."
    },
    {
      "name": "organization",
      "type": "string",
      "label": "Organization",
      "required": false,
      "helpMarkDown": "Azure DevOps organization name. Auto-detected from $(System.CollectionUri) if not provided."
    },
    {
      "name": "project",
      "type": "string",
      "label": "Project",
      "required": false,
      "helpMarkDown": "Azure DevOps project name. Auto-detected from $(System.TeamProject) if not provided."
    },
    {
      "name": "repositoryId",
      "type": "string",
      "label": "Repository ID",
      "required": false,
      "helpMarkDown": "Repository ID (UUID). Auto-detected from $(Build.Repository.Id) if not provided."
    },
    {
      "name": "pullRequestId",
      "type": "string",
      "label": "Pull Request ID",
      "required": false,
      "helpMarkDown": "Pull request number. Auto-detected from $(System.PullRequest.PullRequestId) if not provided."
    }
  ],
  "execution": {
    "Node20_1": {
      "target": "dist/index.js"
    }
  }
}
