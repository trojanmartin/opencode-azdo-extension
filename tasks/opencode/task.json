{
  "$schema": "https://raw.githubusercontent.com/Microsoft/azure-pipelines-task-lib/master/tasks.schema.json",
  "id": "cc22f084-2258-4564-bda6-c37f40e601dc",
  "name": "OpenCodeAgent",
  "friendlyName": "OpenCode Azure DevOps agent extension",
  "description": "Run OpenCode (https://opencode.ai/) in your Azure DevOps pipelines. Use review mode for automated PR review or command mode for comment-triggered runs.",
  "helpMarkDown": "Runs an OpenCode AI agent against the current pull request. In review mode agent . In command mode it responds to /oc or /opencode comments and can commit changes. See https://opencode.ai for provider/model options.",
  "author": "trojanmartin",
  "version": {
    "Major": 0,
    "Minor": 7,
    "Patch": 0
  },
  "instanceNameFormat": "OpenCode",
  "minimumAgentVersion": "2.206.1",
  "inputs": [
    {
      "name": "threadId",
      "type": "string",
      "label": "Thread ID",
      "required": false,
      "helpMarkDown": "PR thread ID containing the trigger comment. Required for command mode (when mode is not set or set to command). Not needed for review mode."
    },
    {
      "name": "commentId",
      "type": "string",
      "label": "Comment ID",
      "required": false,
      "helpMarkDown": "Comment ID that triggered this run. Required for command mode (when mode is not set or set to command). Not needed for review mode."
    },
    {
      "name": "pat",
      "type": "string",
      "label": "Personal Access Token",
      "required": true,
      "helpMarkDown": "Azure DevOps PAT with Code Read (and Write for command mode commits) and Pull Request Threads Read & Write scopes. You may use $(System.AccessToken) if the build service has these permissions."
    },
    {
      "name": "providerID",
      "type": "string",
      "label": "Provider ID",
      "required": true,
      "helpMarkDown": "OpenCode AI provider ID: github-copilot, anthropic, or openai."
    },
    {
      "name": "modelID",
      "type": "string",
      "label": "Model ID",
      "required": true,
      "helpMarkDown": "Model ID for the selected provider (e.g., gpt-4.1, claude-sonnet-4)."
    },
    {
      "name": "agent",
      "type": "string",
      "label": "Agent",
      "defaultValue": "build",
      "required": false,
      "helpMarkDown": "OpenCode agent to run (default: build)."
    },
    {
      "name": "mode",
      "type": "pickList",
      "label": "Execution Mode",
      "defaultValue": "",
      "required": false,
      "options": {
        "": "Auto-detect from trigger comment",
        "command": "Command - Execute agent with user's command",
        "review": "Review - Perform code review of PR changes"
      },
      "helpMarkDown": "Execution mode. 'review' runs headless PR review without a trigger comment. 'command' responds to /oc or /opencode comments. Leave blank to auto-detect from the comment."
    },

    {
      "name": "skipClone",
      "type": "boolean",
      "label": "Skip Git Clone",
      "defaultValue": "false",
      "required": false,
      "helpMarkDown": "Skip cloning the repository. When true, workspacePath must point to an existing checkout."
    },
    {
      "name": "workspacePath",
      "type": "string",
      "label": "Workspace Path",
      "required": false,
      "helpMarkDown": "Directory for the repository workspace. Defaults to $(Build.BinariesDirectory) or $(Agent.TempDirectory). Required when skipClone is true."
    },
    {
      "name": "organization",
      "type": "string",
      "label": "Organization",
      "required": false,
      "helpMarkDown": "Azure DevOps organization name. Auto-detected from System.CollectionUri if omitted."
    },
    {
      "name": "project",
      "type": "string",
      "label": "Project",
      "required": false,
      "helpMarkDown": "Azure DevOps project name. Auto-detected from System.TeamProject if omitted."
    },
    {
      "name": "repositoryId",
      "type": "string",
      "label": "Repository ID",
      "required": false,
      "helpMarkDown": "Repository ID (UUID). Auto-detected from Build.Repository.Id if omitted."
    },
    {
      "name": "pullRequestId",
      "type": "string",
      "label": "Pull Request ID",
      "required": false,
      "helpMarkDown": "Pull request number. Auto-detected from System.PullRequest.PullRequestId if omitted."
    },
    {
      "name": "reviewPrompt",
      "type": "multiLine",
      "label": "Review Prompt",
      "required": false,
      "helpMarkDown": "Custom instructions for the code review (review mode only). Replaces the default review criteria. The script execution instructions and PR context are always included automatically. Example: 'Review for security vulnerabilities, focusing on SQL injection and XSS attacks.'"
    }
  ],
  "execution": {
    "Node20_1": {
      "target": "dist/index.js"
    }
  }
}
