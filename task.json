{
  "$schema": "https://raw.githubusercontent.com/Microsoft/azure-pipelines-task-lib/master/tasks.schema.json",
  "id": "cc22f084-2258-4564-bda6-c37f40e601dc",
  "name": "OpenCodeReview",
  "friendlyName": "OpenCode PR Agent",
  "description": "Azure DevOps pipeline task that responds to PR comments containing '/oc' or '/opencode' by executing the OpenCode AI agent and committing changes back to the PR",
  "helpMarkDown": "This task is triggered by comments in pull requests that contain '/oc' or '/opencode'. It finds the comment, executes the OpenCode AI agent with the PR context, and commits any changes back to the pull request.",
  "author": "trojanmartin",
  "version": {
    "Major": 1,
    "Minor": 0,
    "Patch": 0
  },
  "instanceNameFormat": "OpenCode Agent: PR #$(pullRequestId)",
  "minimumAgentVersion": "2.144.0",
  "inputs": [
    {
      "name": "threadId",
      "type": "string",
      "label": "Thread ID",
      "required": true,
      "helpMarkDown": "The ID of the PR thread containing the trigger comment. Leave empty to auto-detect from the current pipeline context."
    },
    {
      "name": "commentId",
      "type": "string",
      "label": "Comment ID",
      "required": true,
      "helpMarkDown": "The ID of the comment that triggered this task. Leave empty to auto-detect from the current pipeline context."
    },
    {
      "name": "pat",
      "type": "string",
      "label": "Personal Access Token",
      "required": true,
      "helpMarkDown": "Azure DevOps PAT with access to read/write pull request comments and commit code changes."
    },
    {
      "name": "providerID",
      "type": "string",
      "label": "Provider ID",
      "required": true,
      "helpMarkDown": "OpenCode provider ID (e.g., github-copilot, anthropic, openai)"
    },
    {
      "name": "modelID",
      "type": "string",
      "label": "Model ID",
      "required": true,
      "helpMarkDown": "OpenCode model ID to use (e.g., gpt-4.1, claude-sonnet-4)"
    },
    {
      "name": "agent",
      "type": "string",
      "label": "Agent",
      "defaultValue": "build",
      "required": false,
      "helpMarkDown": "OpenCode agent name to execute (default: build)"
    },
    {
      "name": "workspacePath",
      "type": "string",
      "label": "Workspace Path",
      "required": false,
      "helpMarkDown": "Path for cloning the repository. Defaults to Build.BinariesDirectory if available, otherwise Agent.TempDirectory."
    },
    {
      "name": "organization",
      "type": "string",
      "label": "Organization",
      "required": false,
      "helpMarkDown": "Azure DevOps organization name. Auto-detected from System.CollectionUri if not provided."
    },
    {
      "name": "project",
      "type": "string",
      "label": "Project",
      "required": false,
      "helpMarkDown": "Azure DevOps project name. Auto-detected from System.TeamProject if not provided."
    },
    {
      "name": "repositoryId",
      "type": "string",
      "label": "Repository ID",
      "required": false,
      "helpMarkDown": "Repository ID (UUID). Auto-detected from Build.Repository.Id if not provided."
    },
    {
      "name": "pullRequestId",
      "type": "string",
      "label": "Pull Request ID",
      "required": false,
      "helpMarkDown": "Pull request number. Auto-detected from System.PullRequest.PullRequestId if not provided."
    }
  ],
  "execution": {
    "Node16": {
      "target": "dist/index.js"
    }
  }
}
